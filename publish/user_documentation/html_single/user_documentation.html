<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>K3 User Documentation</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="d0e3"></a>K3 User Documentation</h1></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="preface"><a href="#d0e9"></a></span></dt><dt><span class="chapter"><a href="#_presentation">1. Presentation</a></span></dt><dd><dl><dt><span class="section"><a href="#_key_features">1.1. Key features</a></span></dt><dd><dl><dt><span class="section"><a href="#_full_java_compatibility">1.1.1. Full java compatibility</a></span></dt><dt><span class="section"><a href="#_open_class_mechanism">1.1.2. Open class mechanism</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_language_memento">2. Language Memento</a></span></dt><dd><dl><dt><span class="section"><a href="#_main_notations_for_k3">2.1. Main notations for K3.</a></span></dt><dt><span class="section"><a href="#_main_annotations_for_k3">2.2. Main annotations for K3.</a></span></dt><dt><span class="section"><a href="#_project_specific_annotations">2.3. Project Specific Annotations</a></span></dt><dt><span class="section"><a href="#_experimental_annotations">2.4. Experimental  annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#_structure_modelling_annotations">2.4.1. Structure Modelling annotations</a></span></dt><dt><span class="section"><a href="#_design_by_contract_annotations">2.4.2. Design by Contract annotations</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#LanguageReference">3. Language Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#_basic">3.1. Basic</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_an_aspect_on_a_class">3.1.1. Creating an aspect on a class</a></span></dt><dt><span class="section"><a href="#_using_aspect_from_another_k3_xtend_program">3.1.2. Using aspect from another k3/xTend program</a></span></dt><dd><dl><dt><span class="section"><a href="#_disambiguisation">3.1.2.1. Disambiguisation</a></span></dt></dl></dd><dt><span class="section"><a href="#_aspect_inheritance_simple_inheritance">3.1.3. Aspect inheritance (simple inheritance)</a></span></dt><dt><span class="section"><a href="#_calling_a_super_operation">3.1.4. Calling a super operation</a></span></dt></dl></dd><dt><span class="section"><a href="#_advanced">3.2. Advanced</a></span></dt><dd><dl><dt><span class="section"><a href="#_extending_an_aspect_multi_inheritance">3.2.1. Extending an aspect (multi inheritance)</a></span></dt></dl></dd><dt><span class="section"><a href="#_replacing_a_method_of_the_base_class">3.3. Replacing a method of the base class</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_ui_user_guide">4. UI User Guide</a></span></dt><dd><dl><dt><span class="section"><a href="#_new_k3_project_wizard">4.1. New K3 project wizard</a></span></dt><dd><dl><dt><span class="section"><a href="#_modeling_options">4.1.1. Modeling options</a></span></dt><dt><span class="section"><a href="#_dependency_management_option">4.1.2. Dependency management option</a></span></dt><dt><span class="section"><a href="#_templates">4.1.3. Templates</a></span></dt></dl></dd><dt><span class="section"><a href="#_new_example_wizard">4.2. New Example wizard</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_implementation_details">5. Implementation details</a></span></dt><dd><dl><dt><span class="section"><a href="#ImportStaticExtensionWithWildcard">5.1. Import static extension with wildcard</a></span></dt><dt><span class="section"><a href="#_k3_active_annotations">5.2. K3 Active annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#_k3_active_annotations_compilation_example">5.2.1. K3 Active annotations compilation example</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>1.1. <a href="#d0e87">Object Oriented visitor versus Aspect Oriented visitor</a></dt><dt>3.1. <a href="#d0e469">Metamodel used as base for the examples)</a></dt><dt>3.2. <a href="#d0e696">Metamodel used as base for the multi inheritance example</a></dt><dt>3.3. <a href="#d0e731">Multi inheritance example with aspects</a></dt></dl></div><div class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="d0e9"></a></h1></div></div></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">The latest version of this document is available online from <a class="link" href="http://diverse-project.github.io/k3/" target="_top">http://diverse-project.github.io/k3/</a></p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_presentation"></a>Chapter&nbsp;1.&nbsp;Presentation</h1></div></div></div><p>K3 is an action language build  on top of the Xtend programming language in order to use it for <span class="strong"><strong>executable metamodeling</strong></span>.</p><p>Its key feature allows
to "re-open" classes of an Ecore metamodel and to weave new features or
operations in these classes.</p><p>The combinaison of K3 and Xtend allows to address a wide range of activities related to model element manipulation. This includes activites such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">weaving operational semantics in metamodel definition</li><li class="listitem">defining model to model transformations</li><li class="listitem">defining model to text transformations</li></ul></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">For an even larger range of activities, K3 is natively used by Melange. Melange allows to build a type system for models and enable scenarios such as:</p><div xmlns="" class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>Language extension</strong></span> Using high-level operators (e.g. inheritance, merge), language definitions can be manipulated, extended or restrained to create new DSLs.</li><li class="listitem"><span class="strong"><strong>Model polymorphism</strong></span> Melange&#8217;s type system supports
 model polymorphism and substitutability, and the definition of generic
transformations that can be applied on models originating from different
 DSLs.</li></ul></div></div><p>Technically, K3 consists in a set of active annotations that can be used in
plain Xtend files to express e.g. aspects, pre/post conditions or
invariants, and uses Xbase as the expression language for operations
bodies.</p><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">Actually, many of K3 annotations are not dependent on EMF/ecore and can also work on plain java classe.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_key_features"></a>1.1.&nbsp;Key features</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_full_java_compatibility"></a>1.1.1.&nbsp;Full java compatibility</h3></div></div></div><p><span class="strong"><strong>Integrating Kermeta and java code has never been that easy !</strong></span></p><p>K3 action language is built as an extension to Xtend that in turn is able to fully reuse existing java bytecode. <span class="strong"><strong>Java code can be used from Xtend/K3 and vice versa</strong></span>.</p><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p xmlns="">Despite that Kermeta was first intended to model manipulation, this java integration means that K3AL can be used for any kind of program.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_open_class_mechanism"></a>1.1.2.&nbsp;Open class mechanism</h3></div></div></div><p>As all other versions of Kermeta, K3 Action Language leverages the open-class mechanism. It
allows to "re-open" existing meta-classes of a metamodel to insert new features such as attributes, references, or operations. <span class="strong"><strong>Please note that return types of aspects methods cannot be inferred: they must be explicitly written!</strong></span></p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> mypackage

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.diverse.k3.al.annotationprocessor.Aspect

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> mypackage.OtherClass
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> mypackage.OtherClassAspect.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=OtherClass)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> OtherClassAspect {
	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">var</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">int</b> foo = <span class="hl-number">1</span>

    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> display (){
         prinln(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"I am OtherClassAspect"</i>)
         <i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// The keyword _self must be used to refer to attributes and operations of the class and aspect.</i>
         <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.foo = <span class="hl-number">2</span>
         <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.callingOnOperationOfOtherClass()
    }
}</pre><p>This mechanism serves as the basis for the definition of aspects on metamodels elements, enabling aspect-oriented modeling that helps to model complex software artifacts composed of
intertwined and cross-cutting concerns.</p><p>Typical use of such construct are the Visitor and Interpreter design patterns which are implemented in a more elegant and readable way with Aspect Oriented languages than with with classical Object Oriented languages.</p><div class="figure"><a name="d0e87"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/OOVisitor-vs-AOVisitor.png" width="800" alt="Object Oriented visitor versus Aspect Oriented visitor"></div></div><p class="title"><b>Figure&nbsp;1.1.&nbsp;Object Oriented visitor versus Aspect Oriented visitor</b></p></div><br class="figure-break"></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_language_memento"></a>Chapter&nbsp;2.&nbsp;Language Memento</h1></div></div></div><p>This section present a brief overview of the keywords, annotations and syntax elements used by K3. The main elements are detailled in the <a class="xref" href="#LanguageReference" title="Chapter&nbsp;3.&nbsp;Language Reference">Chapter&nbsp;3, <i>Language Reference</i></a> chapter.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_main_notations_for_k3"></a>2.1.&nbsp;Main notations for K3.</h2></div></div></div><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; " width="100%"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">keyword/syntax</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Short description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="emphasis"><em>_self</em></span></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>In an Aspect, <span class="strong"><strong>_self</strong></span> is a reference to the current object.</p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><span class="emphasis"><em>import static extension XYZAspect.*</em></span></p></td><td style="" align="left" valign="top"><p>Makes all features defined on XYZAspect available in the current compilation unit (xtend file). This allows for natural writing using Object Oriented syntax.  (see <a class="xref" href="#ImportStaticExtensionWithWildcard" title="5.1.&nbsp;Import static extension with wildcard">Section&nbsp;5.1, &#8220;Import static extension with wildcard&#8221;</a>)</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_main_annotations_for_k3"></a>2.2.&nbsp;Main annotations for K3.</h2></div></div></div><p>All K3 annotations are defined in the package <code class="literal">fr.inria.diverse.k3.al.annotationprocessor</code></p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; " width="100%"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Annotation</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Applies to</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Short description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Aspect</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Class</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Indicates that the class is an aspect on top of another base class.</p>
<pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=XYZ)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> XYZAspect {}</pre>
<p>In additon to the mandatory <span class="strong"><strong>className</strong></span> attribute, an optionnal <span class="strong"><strong>with</strong></span> attribute can be used in case of multiple inheritance.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@OverrideAspectMethod</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Allows to override a method when an aspect class inherits from another aspect class.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@ReplaceAspectMethod</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Allows to replace a method that is defined in the base class.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@SynchroField</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Field</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>When a field exists both in the base class and in the aspect (same name and type), this annotation make sure to synchronize their values when assigning one of the fields.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Abstract</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Used to tag a k3 operation as abstract when initially defined.</p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Singleton</strong></span></p></td><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">Class</code></p></td><td style="" align="left" valign="top"><p>The fields defined in the aspect are shared by all instances of the base class.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_project_specific_annotations"></a>2.3.&nbsp;Project Specific Annotations</h2></div></div></div><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; " width="100%"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Annotation</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Project</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Applies to</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Short description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Step</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">GEMOC</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><span class="emphasis"><em>Requires Modelanimation framework</em></span>
The method is executed in an EMF Transaction in order to allow edition and observation of the changes on the model.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Main</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">GEMOC</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Used to define possible entry methods of Sequential engine.</p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@InitializeModel</strong></span></p></td><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">GEMOC</code></p></td><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="" align="left" valign="top"><p>Used to define a method that initializes the model before starting an engine (Sequential or Concurrent).</p>
<pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@InitializeModel</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> initialize(List&lt;String&gt; args){}</pre></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_experimental_annotations"></a>2.4.&nbsp;Experimental  annotations</h2></div></div></div><p>Annotations that have been coded but need further development in order to be fully usable. Help welcome :-)</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_structure_modelling_annotations"></a>2.4.1.&nbsp;Structure Modelling annotations</h3></div></div></div><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; " width="100%"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Annotation</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Applies to</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Short description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@NotAspectProperty</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Field</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Composition</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Field</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Containment</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Field</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Opposite</strong></span></p></td><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">Field</code></p></td><td style="" align="left" valign="top">&nbsp;</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_design_by_contract_annotations"></a>2.4.2.&nbsp;Design by Contract annotations</h3></div></div></div><p>This annotation set allows to do some design by contract programming.</p><p><span class="emphasis"><em>Know limitation :</em></span> there is no way to prevent the contracts from doing some side effects on the model.</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; " width="100%"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Annotation</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Applies to</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Short description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Contracted</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Class</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Indicates that the class will define contracts.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Inv</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Indicates that this contract must be true for all instances of the base class.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Pre</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><span class="strong"><strong>@Post</strong></span></p></td><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">Method</code></p></td><td style="" align="left" valign="top">&nbsp;</td></tr></tbody></table></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="LanguageReference"></a>Chapter&nbsp;3.&nbsp;Language Reference</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_basic"></a>3.1.&nbsp;Basic</h2></div></div></div><p>To illustrate the use of K3, in the following sections, we will extend a base
java structure. so let&#8217;s consider the following set of classes of a small ecore
representing a Blog.</p><div class="figure"><a name="d0e469"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/blog-base-diagram.png" alt="blog base diagram"></div></div><p class="title"><b>Figure&nbsp;3.1.&nbsp;Metamodel used as base for the examples)</b></p></div><br class="figure-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_creating_an_aspect_on_a_class"></a>3.1.1.&nbsp;Creating an aspect on a class</h3></div></div></div><p>Defining an aspect on a class is done by adding the annotation <span class="emphasis"><em><span class="strong"><strong>Aspect</strong></span></em></span>
on the class corresponding to the aspect. The annotation parameter <span class="strong"><strong>className</strong></span> will indicates which is the base
class that will be augmented.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> blogsite.aspects

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.diverse.k3.al.annotationprocessor.Aspect <a name="CO1-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> blogsite.Blog

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Blog)</b> <a name="CO1-2"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> BlogAspect {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> display (){
         prinln(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"I am BlogAspect"</i>)
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Import the annotation processor for Aspect</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-2"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Add an aspect on top of class Blog</p></td></tr></table></div><p>In an aspect you can use the attributes and operations of both the augmented
class and the aspect itself.</p><p>In aspects, <span class="strong"><strong>the keyword</strong></span> "<span class="emphasis"><em><span class="strong"><strong>this</strong></span></em></span>"
<span class="strong"><strong>must not be used</strong></span>. Use the
keyword "<span class="strong"><strong>_self</strong></span>" instead.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Blog)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> BlogAspect {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">int</b> blogVersion = <span class="hl-number">1</span> <a name="CO2-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>

    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> changeTitle (String  newTitle, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">int</b> newVersion){
         <i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// The keyword _self must be used to refer to attributes and operations of the class and aspect.</i>
         <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.blogVersion = newVersion <a name="CO2-2"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>
         <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.title =  newTitle <a name="CO2-3"></a><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>this attribute exists only in the aspect</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-2"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>in aspect, attribute defined on aspect is accessed via <span class="strong"><strong>_self</strong></span></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-3"><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>in aspect, attribute defined on the base class is accessed via <span class="strong"><strong>_self</strong></span></p></td></tr></table></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p xmlns="">Despite it should be legal, due to a bug in xtend, we <span class="strong"><strong>do not</strong></span> recommand the following syntax:</p><pre xmlns="" class="screen">@Aspect(className=typeof(OtherClass))</pre><p xmlns="">It may raise strange scope issue, especially in case of aspects
defined in several packages.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_aspect_from_another_k3_xtend_program"></a>3.1.2.&nbsp;Using aspect from another k3/xTend program</h3></div></div></div><p>To use the aspect, you need to import the correct classes and indicates to
xTend thant some additionnal features can come from the aspect.</p><p>This is done using the special import <span class="strong"><strong>import
static extension</strong></span> which enable the use of the additions declared
in the aspect.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> blogsite.demo

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> blogsite.Blog
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> blogsite.aspects.BlogAspect

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> blogsite.aspects.BlogAspect.* <a name="CO3-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Main {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> main(){
      <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">val</b> Blog b1 = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">new</b> Blog
      b1.display() <a name="CO3-2"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>This <span class="emphasis"><em>import static extension
&lt;myPkg.AspectName&gt;.*</em></span> allows to make visible the attributes and
operations defined on BlogAspect.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-2"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>method display() is visible thanks to the <span class="emphasis"><em>import
static extension BlogAspect.*</em></span></p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_disambiguisation"></a>3.1.2.1.&nbsp;Disambiguisation</h4></div></div></div><p>If several operations or attributes have similar names, xTend may not find the
expected feature. In that case you need to disambiguise the call by accessing
the underlying helper class.</p><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">To have more details about the precise mecanism of this helper class
please refer to the chapter at the end of this document.</p></div><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Blog)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> BlogAspect2 {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">int</b> title = <span class="hl-number">1</span> <a name="CO4-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>
}</pre><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> blogsite.aspects.BlogAspect2.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Main {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> main(){
      <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">val</b> Blog b1 = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">new</b> Blog
      println( b1.title) <a name="CO4-2"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>
      println( BlogAspect2.title(b1) <a name="CO4-3"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Might be ambiguous because it reuse the name of an attribute on the base class</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-2"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>returns the attribute <code class="literal">title</code> of the base object
b1.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-3"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>return the attribute <code class="literal">title</code> of the companion object
for the aspect BlogAspect2.</p></td></tr></table></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p xmlns="">Be careful when cleaning unused imports while your programs isn&#8217;t complete (for example using <span class="strong"><strong>ctrl+shift+o</strong></span>) because it will also removed unused static extension and will disable the code completion (<span class="strong"><strong>ctrl+space</strong></span>) for the features of these aspects.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_aspect_inheritance_simple_inheritance"></a>3.1.3.&nbsp;Aspect inheritance (simple inheritance)</h3></div></div></div><p>An Aspect class can inherit fields and methods from another class. The simple inheritance is acheived using the <span class="strong"><strong><span class="emphasis"><em>extends</em></span></strong></span> keyword from Xtend.</p><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p xmlns="">However, as for Java, an aspect can directly inherit from only one aspect ! For
multiple inheritance, please refer to the advanced section.</p></div><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> blogsite.aspects

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.diverse.k3.al.annotationprocessor.Aspect
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.diverse.k3.al.annotationprocessor.OverrideAspectMethod

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> blogsite.HasAuthor
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> blogsite.Post

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> blogsite.HasAuthor.*
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> blogsite.PostAspect.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=HasAuthor)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> HasAuthorAspect {

    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> String display (){
        returns <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.author
    }
}

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Post)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> PostAspect <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extends</b> HasAuthorAspect{ <a name="CO5-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>

    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@OverrideAspectMethod</b> <a name="CO5-2"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> String display (){
        returns <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.title + <i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">" by "</i> + <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.author
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>PostAspect inherits from HasAuthorAspect</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-2"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>the <span class="strong"><strong><span class="emphasis"><em>OverrideAspectMethod</em></span></strong></span>
annotionation is required to indicates that the method already exists in the
parent aspect class and must be overriden.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_calling_a_super_operation"></a>3.1.4.&nbsp;Calling a super operation</h3></div></div></div><p>A call to a super operation can be done by writing <span class="strong"><strong>super_</strong></span> followed by the name of the
operation. Do not forget to use <span class="strong"><strong>_self</strong></span>
to handle elements of the class or aspect.</p><p>The previous example could have been written like this:</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> blogsite.aspects

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.diverse.k3.al.annotationprocessor.Aspect
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.diverse.k3.al.annotationprocessor.OverrideAspectMethod

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> blogsite.HasAuthor
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> blogsite.Post

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> blogsite.HasAuthor.*
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> blogsite.PostAspect.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Post)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> PostAspect <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extends</b> HasAuthorAspect{

    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@OverrideAspectMethod</b>
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> String display (){
        returns <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.title + <i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">" by "</i> + <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.super_display() <a name="CO6-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO6-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>call the parent display() method</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_advanced"></a>3.2.&nbsp;Advanced</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_extending_an_aspect_multi_inheritance"></a>3.2.1.&nbsp;Extending an aspect (multi inheritance)</h3></div></div></div><p>Even if Java allows only one inheritance via <span class="emphasis"><em>extends</em></span>.
When using EMF, it is legal to inherit from several class. The underlying framework will take care to implement a pattern using Interfaces.</p><p>Our aspects must also be able to deal  with that situation.</p><p>The <span class="strong"><strong>@Aspect</strong></span> annotation can then take a <span class="strong"><strong>with</strong></span> attribute to indicate this inheritance.</p><p>If the following ecore model and its java implementation, there is a multi-inheritance from Child class to 3 ParentX classes.</p><div class="figure"><a name="d0e696"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/multi-inheritance-base-diagram.png" alt="multi inheritance base diagram"></div></div><p class="title"><b>Figure&nbsp;3.2.&nbsp;Metamodel used as base for the multi inheritance example</b></p></div><br class="figure-break"><p>then, in order to correctly reflect these inheritances in the aspects, we will define the following.</p><pre class="programlisting"><i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// [..]</i>

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> multiparents.Parent1.*
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> multiparents.Parent2.*
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> multiparents.Parent3.*
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> multiparents.Child.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Parent1)</b> <a name="CO7-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Parent1Aspect {
   <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> someParent1Method(){
      <i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// [..]</i>
   }
}
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Parent2)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Parent2Aspect {
   <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> someParent2Method(){
      <i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// [..]</i>
   }
}
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Parent3)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Parent3Aspect {
   <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> someParent3Method(){
      <i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// [..]</i>
   }
}

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Child, with=#[ParentAspect2, ParentAspect3] )</b> <a name="CO7-2"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> PostAspect <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extends</b> Parent1Aspect{ <a name="CO7-3"></a><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span>
   <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> someMethod(){
      <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.someParent1Method()
      <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.someParent2Method()
      <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.someParent3Method()
   }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>each parent defines its own aspects.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-2"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>secondary aspect inheritances are added thanks to the <span class="strong"><strong>with</strong></span> attribute.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-3"><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>primary aspect inheritance is declared using the <span class="strong"><strong>extends</strong></span> keyword like a single inheritance.</p></td></tr></table></div><div class="figure"><a name="d0e731"></a><div class="figure-contents"><div class="mediaobject"><img src="./images/multi-inheritance-base_and_aspects-diagram.png" alt="multi inheritance base and aspects diagram"></div></div><p class="title"><b>Figure&nbsp;3.3.&nbsp;Multi inheritance example with aspects</b></p></div><br class="figure-break"><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p xmlns="">The syntax <code class="literal">with=#[ParentAspect2, ParentAspect3]</code>  indicates that we create a list with 2 additional parents (in addition to the primary one that has been defined using the <span class="strong"><strong>extends</strong></span> keyword). If there is only one additional parent, then the following syntax will also work : <code class="literal">with=ParentAspect2</code></p></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p xmlns="">When an ecore model defines an inheritance structure, the best practice is to fully reflect the structure in the aspects. Othewise, the dynamic dispatch may lead to non-intuitive behaviors.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_replacing_a_method_of_the_base_class"></a>3.3.&nbsp;Replacing a method of the base class</h2></div></div></div><p>K3 uses the <span class="strong"><strong>@ReplaceAspectMethod</strong></span> annotation to replace a method that is defined in the base class by a method in the aspect.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_ui_user_guide"></a>Chapter&nbsp;4.&nbsp;UI User Guide</h1></div></div></div><p>K3 comes with several wizard and template facilities to help you start your projects.</p><p>This can be either by reproducing one of the featured examples or by using the <span class="emphasis"><em>new K3 project wizard</em></span>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_new_k3_project_wizard"></a>4.1.&nbsp;New K3 project wizard</h2></div></div></div><p>As K3 can be used in several situations, the wizard allows to create project for the various configurations:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Eclipse plugin</li><li class="listitem">Standard java project with embedded libraries (compiled with eclipse)</li><li class="listitem">Maven java project</li></ol></div><p>and using a modeling framework or not.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/new_k3_project_screenshot.png" alt="new k3 project screenshot"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_modeling_options"></a>4.1.1.&nbsp;Modeling options</h3></div></div></div><p>The Modeling environment can also be set to use EMF/Ecore
when checking the <span class="strong"><strong>Use EMF</strong></span> option. In this case it will  add the dependencies to the correct jars dependeing on the dependency management Eclipse plugin with Ecore/EMF.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_dependency_management_option"></a>4.1.2.&nbsp;Dependency management option</h3></div></div></div><p>When set to <span class="strong"><strong>Plug-in</strong></span> the project uses the Eclipse Plugin nature for defining the dependencies.
So all the K3 jar and xTend jar will be referenced in the <span class="emphasis"><em>manifest.mf</em></span> of the project.</p><p>When set to <span class="strong"><strong>Standalone</strong></span>
In that mode, all the depencies are copied in a lib folder.
This includes K3 jar, but also xTend jar.
It is based on the eclipse standard java compiler for defining dependencies.
This mode can be useful as a base for small project with few dependencies</p><p>When set to <span class="strong"><strong>Maven</strong></span>
In that mode, the project will be a maven project and dependencies will be resolved using maven.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_templates"></a>4.1.3.&nbsp;Templates</h3></div></div></div><p>when clicking on <span class="emphasis"><em>next</em></span> in the first page your can acces to the <span class="emphasis"><em>templates</em></span></p><div class="informalfigure"><div class="mediaobject"><img src="./images/new_k3_project_templates_screenshot.png" alt="new k3 project templates screenshot"></div></div><p>These templates allows to create typical project structures for various needs.</p><p>One of the most useful is the <span class="emphasis"><em>Use Ecore Basic aspect</em></span> which asks the user for an initial Ecore model (and its project). With this ecore model, it will automatically create an aspect class for each metaclasses in the ecore. It takes care of replicating the inheritance tree in the aspects classes.</p><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">Please note that some templates may require a given dependency management or modeling framework. Those templates will not be available if the options on the first page are not compatible with the template.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_new_example_wizard"></a>4.2.&nbsp;New Example wizard</h2></div></div></div><p>K3 comes with a set of running examples that you can use as a starting point.</p><p>Retreive them from Eclipse: <span class="emphasis"><em>File &gt; New &gt; Example&#8230;&#8203; &gt;</em></span>
then look for the K3 category.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_implementation_details"></a>Chapter&nbsp;5.&nbsp;Implementation details</h1></div></div></div><p>This section presents how K3 is implemented and which compiling scheme it follows.</p><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">Understanding how K3 use Xtend syntax and how K3 compilation scheme changes xtend java code generation should help understand  some issues or help integrating K3 code in larger applications.</p></div><p>Basically, K3 works by combining 2 mains Xtend mecanisms :</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://www.eclipse.org/xtend/documentation/202_xtend_classes_members.html#extension-imports" target="_top">Static Extension import</a> with wildcards.</li><li class="listitem"><a class="link" href="http://www.eclipse.org/xtend/documentation/204_activeannotations.html" target="_top">Active annotations</a>.</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ImportStaticExtensionWithWildcard"></a>5.1.&nbsp;Import static extension with wildcard</h2></div></div></div><p>In  Java, <span class="strong"><strong><a class="link" href="https://en.wikipedia.org/wiki/Static_import" target="_top">Static import</a></strong></span> is a feature  that allows members (fields and methods) defined in a class as <code class="literal">public static</code> to be used in Java code without specifying the class in which the field is defined. The wildcard allow to access all the static members of a class.</p><p>Similarily, in Xtend, <a class="link" href="http://www.eclipse.org/xtend/documentation/202_xtend_classes_members.html#extension-methods" target="_top">extension methods</a> allow to add new methods to existing types without modifying them.
They are based on a simple syntactic trick: Instead of passing the first
 argument of an extension method inside the parentheses of a method
invocation, the method can be called with the first argument as its
receiver - it can be called as if the method was one of the argument
type&#8217;s members.</p><p>When used with a wildcard, the <code class="literal">import static extension</code> allow to apply this to all static methods of a class.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> java.lang.Math.*;
<i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// [..]</i>

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">val</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">double</b> f1 = <span class="hl-number">2.5</span>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">val</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">double</b> f2 = <span class="hl-number">2.9</span>

Math.max(f1,f2) <a name="CO8-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>

max(f1,f2) <a name="CO8-2"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>

f1.max(f2) <a name="CO8-3"></a><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>is the classic way to access the static method (with only a <code class="literal">import java.lang.Math</code> )</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-2"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>is allowed by java with an <code class="literal">import java.lang.Math.*</code> or <code class="literal">import java.lang.Math.max</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-3"><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>is allowed by Xtend&#8217;s <code class="literal">extension</code>. This pointed notation gives the feeling to call the <code class="literal">max</code> method as if it was defined on <code class="literal">double</code>.</p></td></tr></table></div><p>K3 use this mecanism extensively in order to provide the feeling of writing object oriented call on methods and attributes on aspects which are actually static methods..</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_k3_active_annotations"></a>5.2.&nbsp;K3 Active annotations</h2></div></div></div><p><code class="literal">import static extension</code> is enough to contribute operations to a class, however we also often need to contribute fields.</p><p>To do so, K3 implement a set of <a class="link" href="http://www.eclipse.org/xtend/documentation/204_activeannotations.html" target="_top">Active annotations</a>. This kind of annoation allows to contribute to Xtend java code generator and rewrite a part of the resulting java code.</p><p>The <span class="strong"><strong>@Aspect</strong></span> annotation allows to generate a set of classes that declares static methods that will be made avialable thanks to the <code class="literal">import static extension</code>. This set of classes implements a pattern that allows to to store the fields defined in the aspects.</p><p>For every aspect class:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">it creates a class with static methods. It acts as the public interface for the aspect.</li><li class="listitem">It creates an <code class="literal">*AspectProperties</code> class that is the companion object that will store the attributes defined by aspect.</li><li class="listitem">It creates an <code class="literal">*AspectContext</code> class that defines the mapping between the base object and the companion object.</li></ul></div><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p xmlns="">The result of the compilation of Xtend and K3 annotations in plain java is visible in the <code class="literal">xtend-gen</code> folder.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_k3_active_annotations_compilation_example"></a>5.2.1.&nbsp;K3 Active annotations compilation example</h3></div></div></div><p>Let&#8217;s consider the following K3 code that adds a String attribute to the <code class="literal">java.io.File</code> class:</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> k3project.SampleXMLFileAspect.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=java.io.File )</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> SampleXMLFileAspect {
	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> String contentType = <i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">""</i>
}
<i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">//[..]</i>
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">val</b> f = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">new</b> File(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"toto.txt"</i>)
    f.contentType = <i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"txt"</i></pre><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">Obviously, this will also work for operations. Adding an attribute is simply a little bit more complex since from xtend point of view, it adds 2 methods: the getter and the setter</p></div><p>It will be compiled in 3 Java classes : <code class="literal">SampleXMLFileAspect</code>, <code class="literal">SampleXMLFileAspectFileAspectContext</code> and <code class="literal">SampleXMLFileAspectFileAspectProperties</code>.</p><p><code class="literal">SampleXMLFileAspect</code> is the public interface that declares all <code class="literal">public static</code> methods that are make available with the <code class="literal">import static extension</code>. A technical part is kept in private.</p><div xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p xmlns="">You can notice the systematic use of <span class="strong"><strong>_self</strong></span> as the first parameter of the static methods. This allows to access to the object instance from the bodies of aspect methods.</p></div><p><code class="literal">SampleXMLFileAspectFileAspectProperties</code> is the companion object that is associated to the base object.</p><p><code class="literal">SampleXMLFileAspectFileAspectContext</code> implements the map that allows to get the companion object <code class="literal">SampleXMLFileAspectFileAspectProperties</code> via the <span class="strong"><strong>_self</strong></span> keyword.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> SampleXMLFileAspectFileAspectProperties {
  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> String contentType = <i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">""</i>;
}</pre><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> SampleXMLFileAspect {

  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> String contentType(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> File _self) { <a name="CO9-1"></a><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span>
    k3project.SampleXMLFileAspectFileAspectProperties _self_ = k3project.SampleXMLFileAspectFileAspectContext.getSelf(_self);
    Object result = null;
    result =_privk3_contentType(_self_, _self);
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">return</b> (java.lang.String)result;
  }

  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> contentType(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> File _self, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> String contentType) { <a name="CO9-2"></a><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span>
    k3project.SampleXMLFileAspectFileAspectProperties _self_ = k3project.SampleXMLFileAspectFileAspectContext.getSelf(_self);
    _privk3_contentType(_self_, _self,contentType);
  }
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">protected</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> String _privk3_contentType(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> SampleXMLFileAspectFileAspectProperties _self_, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> File _self) {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">try</b> { <a name="CO9-3"></a><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span>
    	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">for</b> (java.lang.reflect.Method m : _self.getClass().getMethods()) {
    		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">if</b> (m.getName().equals(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"getContentType"</i>) &amp;&amp;
    			m.getParameterTypes().length == <span class="hl-number">0</span>) {
    				Object ret = m.invoke(_self);
    				<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">if</b> (ret != null) {
    					<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">return</b> (java.lang.String) ret;
    				}
    		}
    	}
    } <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">catch</b> (Exception e) {
    	<i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// Chut !</i>
    }
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">return</b> _self_.contentType;
  }

  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">protected</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> _privk3_contentType(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> SampleXMLFileAspectFileAspectProperties _self_, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> File _self, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> String contentType) { <a name="CO9-4"></a><span><img src="gfx/callouts/4.gif" alt="4" border="0"></span>
    _self_.contentType = contentType; <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">try</b> {
    	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">for</b> (java.lang.reflect.Method m : _self.getClass().getMethods()) {
    		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">if</b> (m.getName().equals(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"setContentType"</i>)
    				&amp;&amp; m.getParameterTypes().length == <span class="hl-number">1</span>) {
    			m.invoke(_self, contentType);
    		}
    	}
    } <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">catch</b> (Exception e) {
    	<i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// Chut !</i>
    }
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-1"><span><img src="gfx/callouts/1.gif" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>public getter operation seen from xtend</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-2"><span><img src="gfx/callouts/2.gif" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>public setter operation seen from xtend</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-3"><span><img src="gfx/callouts/3.gif" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>real getter code in the <span class="emphasis"><em>privk3</em></span> method</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-4"><span><img src="gfx/callouts/4.gif" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>real setter code in the <span class="emphasis"><em>privk3</em></span> method</p></td></tr></table></div><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> SampleXMLFileAspectFileAspectContext {
  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> SampleXMLFileAspectFileAspectContext INSTANCE = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">new</b> SampleXMLFileAspectFileAspectContext();

  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> SampleXMLFileAspectFileAspectProperties getSelf(<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">final</b> File _self) {
    		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">if</b> (!INSTANCE.map.containsKey(_self))
    			INSTANCE.map.put(_self, <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">new</b> k3project.SampleXMLFileAspectFileAspectProperties());
    		<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">return</b> INSTANCE.map.get(_self);
  }
  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">private</b> Map<strong class="hl-tag" style="color: #000096">&lt;File,</strong> <span class="hl-attribute" style="color: #F5844C">ModuleAspectFileAspectProperties</span><strong class="hl-tag" style="color: #000096"> &gt;</strong> map =
  	<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">new</b> java.util.WeakHashMap<strong class="hl-tag" style="color: #000096">&lt;java.io.File,</strong> <span class="hl-attribute" style="color: #F5844C">k3project.ModuleAspectFileAspectProperties</span><strong class="hl-tag" style="color: #000096"> &gt;</strong> ();

  <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">public</b> Map<strong class="hl-tag" style="color: #000096">&lt;File,</strong> <span class="hl-attribute" style="color: #F5844C">ModuleAspectFileAspectProperties&gt;</span> <span class="hl-attribute" style="color: #F5844C">getMap()</span> <span class="hl-attribute" style="color: #F5844C">{</span>
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">return</b> map;
  }

}</pre></div></div></div></div></body></html>