<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;3.&nbsp;Language Reference</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="user_documentation.html" title="K3 User Documentation"><link rel="up" href="user_documentation.html" title="K3 User Documentation"><link rel="prev" href="ch02s04.html" title="Experimental annotations"><link rel="next" href="ch03s02.html" title="Advanced"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;3.&nbsp;Language Reference</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s04.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s02.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="LanguageReference"></a>Chapter&nbsp;3.&nbsp;Language Reference</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="ch03.html#_basic">Basic</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#_creating_an_aspect_on_a_class">Creating an aspect on a class</a></span></dt><dt><span class="section"><a href="ch03.html#_using_aspect_from_another_k3_xtend_program">Using aspect from another k3/xTend program</a></span></dt><dt><span class="section"><a href="ch03.html#_aspect_inheritance_simple_inheritance">Aspect inheritance (simple inheritance)</a></span></dt><dt><span class="section"><a href="ch03.html#_calling_a_super_operation">Calling a super operation</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s02.html">Advanced</a></span></dt><dd><dl><dt><span class="section"><a href="ch03s02.html#_extending_an_aspect_multi_inheritance">Extending an aspect (multi inheritance)</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s03.html">Replacing a method of the base class</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_basic"></a>Basic</h2></div></div></div><p>To illustrate the use of K3, in the following sections, we will extend a base
java structure. so let&#8217;s consider the following set of classes of a small ecore
representing a Blog.</p><div class="figure"><a name="d0e458"></a><p class="title"><b>Figure&nbsp;3.1.&nbsp;Metamodel used as base for the examples)</b></p><div class="figure-contents"><div class="mediaobject"><img src="./images/blog-base-diagram.png" alt="blog base diagram"></div></div></div><br class="figure-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_creating_an_aspect_on_a_class"></a>Creating an aspect on a class</h3></div></div></div><p>Defining an aspect on a class is done by adding the annotation <span class="emphasis"><em><span class="strong"><strong>Aspect</strong></span></em></span>
on the class corresponding to the aspect. The annotation parameter <span class="strong"><strong>className</strong></span> will indicates which is the base
class that will be augmented.</p><pre class="programlisting">package blogsite.aspects

import fr.inria.diverse.k3.al.annotationprocessor.Aspect <a name="CO1-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>

import blogsite.Blog

@Aspect(className=Blog) <a name="CO1-2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
class BlogAspect {
    def void display (){
         prinln("I am BlogAspect")
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Import the annotation processor for Aspect</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Add an aspect on top of class Blog</p></td></tr></table></div><p>In an aspect you can use the attributes and operations of both the augmented
class and the aspect itself.</p><p>In aspects, <span class="strong"><strong>the keyword</strong></span> "<span class="emphasis"><em><span class="strong"><strong>this</strong></span></em></span>"
<span class="strong"><strong>must not be used</strong></span>. Use the
keyword "<span class="strong"><strong>_self</strong></span>" instead.</p><pre class="programlisting">@Aspect(className=Blog)
class BlogAspect {
    int blogVersion = 1 <a name="CO2-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>

    def void changeTitle (String  newTitle, int newVersion){
         // The keyword _self must be used to refer to attributes and operations of the class and aspect.
         _self.blogVersion = newVersion <a name="CO2-2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
         _self.title =  newTitle <a name="CO2-3"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>this attrbute exists only in the aspect</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>in aspect, attribute defined on aspect is accessed via <span class="strong"><strong>_self</strong></span></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-3"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>in aspect, attribute defined on the base class is accessed via <span class="strong"><strong>_self</strong></span></p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Despite it should be legal, due to a bug in xtend, we <span class="strong"><strong>do not</strong></span> recommand the following syntax:</p><pre class="screen">@Aspect(className=typeof(OtherClass))</pre><p>It may raise strange scope issue, especially in case of aspects
defined in several packages.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_aspect_from_another_k3_xtend_program"></a>Using aspect from another k3/xTend program</h3></div></div></div><p>To use the aspect, you need to import the correct classes and indicates to
xTend thant some additionnal features can come from the aspect.</p><p>This is done using the special import <span class="strong"><strong>import
static extension</strong></span> which enable the use of the additions declared
in the aspect.</p><pre class="programlisting">package blogsite.demo

import blogsite.Blog
import blogsite.aspects.BlogAspect

import static extension blogsite.aspects.BlogAspect.* <a name="CO3-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>

class Main {
    def static void main(){
      val Blog b1 = new Blog
      b1.display() <a name="CO3-2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>This <span class="emphasis"><em>import static extension
&lt;myPkg.AspectName&gt;.*</em></span> allows to make visible the attributes and
operations defined on BlogAspect.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>method display() is visible thanks to the <span class="emphasis"><em>import
static extension BlogAspect.*</em></span></p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_disambiguisation"></a>Disambiguisation</h4></div></div></div><p>If several operations or attributes have similar names, xTend may not find the
expected feature. In that case you need to disambiguise the call by accessing
the underlying helper class.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>To have more details about the precise mecanism of this helper class
please refer to the chapter at the end of this document.</p></div><pre class="programlisting">@Aspect(className=Blog)
class BlogAspect2 {
    int title = 1 <a name="CO4-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
}</pre><pre class="programlisting">import static extension blogsite.aspects.BlogAspect2.*

class Main {
    def static void main(){
      val Blog b1 = new Blog
      println( b1.title) <a name="CO4-2"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
      println( BlogAspect2.title(b1) <a name="CO4-3"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Might be ambiguous because it reuse the name of an attribute on the base class</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-2"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>returns the attribute <code class="literal">title</code> of the base object
b1.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-3"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>return the attribute <code class="literal">title</code> of the companion object
for the aspect BlogAspect2.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>Be careful when cleaning unused imports while your programs isn&#8217;t complete (for example using <span class="strong"><strong>ctrl+shift+o</strong></span>) because it will also removed unused static extension and will disable the code completion (<span class="strong"><strong>ctrl+space</strong></span>) for the features of these aspects.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_aspect_inheritance_simple_inheritance"></a>Aspect inheritance (simple inheritance)</h3></div></div></div><p>An Aspect class can inherit fields and methods from another class. The simple inheritance is acheived using the <span class="strong"><strong><span class="emphasis"><em>extends</em></span></strong></span> keyword from Xtend.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>However, as for Java, an aspect can directly inherit from only one aspect ! For
multiple inheritance, please refer to the advanced section.</p></div><pre class="programlisting">package blogsite.aspects

import fr.inria.diverse.k3.al.annotationprocessor.Aspect
import fr.inria.diverse.k3.al.annotationprocessor.OverrideAspectMethod

import blogsite.HasAuthor
import blogsite.Post

import static extension blogsite.HasAuthor.*
import static extension blogsite.PostAspect.*

@Aspect(className=HasAuthor)
class HasAuthorAspect {

    def String display (){
        returns _self.author
    }
}

@Aspect(className=Post)
class PostAspect extends HasAuthorAspect{ <a name="CO5-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>

    @OverrideAspectMethod <a name="CO5-2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
    def String display (){
        returns _self.title + " by " + _self.author
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>PostAspect inherits from HasAuthorAspect</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>the <span class="strong"><strong><span class="emphasis"><em>OverrideAspectMethod</em></span></strong></span>
annotionation is required to indicates that the method already exists in the
parent aspect class and must be overriden.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_calling_a_super_operation"></a>Calling a super operation</h3></div></div></div><p>A call to a super operation can be done by writing <span class="strong"><strong>super_</strong></span> followed by the name of the
operation. Do not forget to use <span class="strong"><strong>_self</strong></span>
to handle elements of the class or aspect.</p><p>The previous example could have been written like this:</p><pre class="programlisting">package blogsite.aspects

import fr.inria.diverse.k3.al.annotationprocessor.Aspect
import fr.inria.diverse.k3.al.annotationprocessor.OverrideAspectMethod

import blogsite.HasAuthor
import blogsite.Post

import static extension blogsite.HasAuthor.*
import static extension blogsite.PostAspect.*

@Aspect(className=Post)
class PostAspect extends HasAuthorAspect{

    @OverrideAspectMethod
    def String display (){
        returns _self.title + " by " + _self.super_display() <a name="CO6-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO6-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>call the parent display() method</p></td></tr></table></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s04.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Experimental  annotations&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="user_documentation.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Advanced</td></tr></table></div></body></html>